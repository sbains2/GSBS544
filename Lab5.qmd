---
title: GSBS544 Lab 5
author: Sahil Bains
format:
  html:
    embed-resources: true
    code-fold: true
echo: true
---
Github Link: https://github.com/sbains2/GSBS544

## Part One: Data Exploration
The dataset we will study for this assignment contains information about health insurance costs for individuals with no dependents (children) in the United States. The information contained in the data is:

- Age of primary beneficiary

- Gender of primary beneficiary (only female, male recorded)

- Body mass index, providing an understanding of body, weights that are relatively high or low relative to height, objective index of body weight (kg / m ^ 2) using the ratio of height to weight, ideally 18.5 to 24.9

- Whether the beneficiary smokes

- The beneficiary’s residential area in the US, northeast, southeast, southwest, northwest.

- Individual medical costs billed by health insurance

Read in the dataset, and display some summaries of the data.

Fix any concerns you have about the data.

Make up to three plots comparing the response variable (charges) to one of the predictor variables. Briefly discuss each plot.

```{python}
import pandas as pd
import numpy as np
from plotnine import *
from sklearn import *

# Reading in the data and doing some preliminary checks
df = pd.read_csv('Insurance Costs.csv')
df.info()
df.describe()

# Making dummy variables for sex, region, smoking status
sex_dummies = pd.get_dummies(df['sex'])
region_dummies = pd.get_dummies(df['region'])
smoker_dummies = pd.get_dummies(df['smoker'], prefix='smoker')

df = pd.concat([df, sex_dummies, region_dummies, smoker_dummies], axis=1)
df
```


```{python}
# Plot 1
# Making plots comparing charges to one's smoking status
(
    ggplot(df, aes(x='smoker', y='charges'))
    + geom_boxplot()
)

```

The first plot that I made was to determine the individual medical costs for individuals that smoked. I used a boxplot to determine the distribution of mcharges given one's smoking status and found that those who smoked paid significantly more in individual medical costs.

```{python}
# Making a plot to see the association between bmi and individual medical charges, with the color of each point being age
(
    ggplot(df, aes(x='bmi', y='charges', color='age'))
    + geom_point()
)
```

The second plot I made was to determine the association between BMI and individual medical costs billed. There was no notable relationship between these two variables, but one is able to see that older people pay somewhat more for individual medical costs.

```{python}
# Plotting gender against individual medical charges
(
    ggplot(df, aes(x='male', y='charges'))
    + geom_boxplot()
)
```

The third plot I made was to look at the distribution of individual medical costs between genders. While the interquartile ranges are somewhat similar, there is far more outliers for females than males with higher individual medical costs.


Part Two: Simple Linear Models
Construct a simple linear model to predict the insurance charges from the beneficiary’s age. Discuss the model fit, and interpret the coefficient estimates.

Make a model that also incorporates the variable sex. Report your results.

Now make a model that does not include sex, but does include smoker. Report your results.

Which model (Q2 or Q3) do you think better fits the data? Justify your answer by calculating the MSE for each model, and also by comparing R-squared values.

```{python}
import math
# Defining target of medical cost and explanatory variable age.
y = df['charges']
X = df[['age']]

# Training the data
yt, yv, Xt, Xv = train_test_split(y, X, test_size=0.2, random_state=42)
m = LinearRegression()

# Fitting the model
train = m.fit(Xt, yt)

# finding R^2 score
r2 = m.score(Xv, yv)

# predicting
y_pred = m.predict(Xv)

mse = mean_squared_error(yv, y_pred)
rmse = math.sqrt(mse)

print(f'R^2 for charges dependent on age: {r2}, MSE: {mse}, RMSE: {rmse}')

```


```{python}
# Defining target of medical cost and explanatory variable age, and gender.
y = df['charges']
X = df[['age', 'male']]

# Training the data
yt, yv, Xt, Xv = train_test_split(y, X, test_size=0.2, random_state=42)
m = LinearRegression()

# Fitting the model
train = m.fit(Xt, yt)

# finding R^2 score
r2 = m.score(Xv, yv)

# predicting
y_pred = m.predict(Xv)

mse = mean_squared_error(yv, y_pred)
rmse = math.sqrt(mse)

print(f'R^2 for charges dependent on age and sex: {r2}, MSE: {mse}, RMSE: {rmse}')

```


```{python}
# Defining target of medical cost and explanatory variable age, and smoking status.
y = df['charges']
X = df[['age', 'smoker_yes']]

# Training the data
yt, yv, Xt, Xv = train_test_split(y, X, test_size=0.2, random_state=42)
m = LinearRegression()

# Fitting the model
train = m.fit(Xt, yt)

# finding R^2 score
r2 = m.score(Xv, yv)

# predicting
y_pred = m.predict(Xv)

mse = mean_squared_error(yv, y_pred)
rmse = math.sqrt(mse)

print(f'R^2 for charges dependent on age and smoking status: {r2}, MSE: {mse}, RMSE: {rmse}')

```

From looking at the model metrics, we're able to see that age and smoking status tended to explain the variation of medical costs the most, with an R2 value of 0.831. In addition to this, we see that this model also has the lowest mean squared error. When looking at the root mean squared error for this model, we see that on average, the model prediction error is around $5,200.

